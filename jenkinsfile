
  pipeline {
  agent any 
  environment {     
    DOCKERHUB_CREDENTIALS= credentials('DOCKERHUB_CREDENTIALS_GIZ')     
} 
 stages{
  stage('checkout'){
    steps{
	checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[credentialsId: 'GitHUB_Credentials-Giz', url: 'https://github.com/ggutu/simplePython-microservices-.git']])
	}
    }
	stage('docker build image'){
    steps{
	 script{
	  sh  'docker build -t gizachewgutu/microservice .'
	   }
	}
    }
   stage('Login to Docker Hub') {      	
    steps{                       	
	sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'                		
	echo 'Login Completed'      
    }           
} 
stage('Push Image to Docker Hub') {         
    steps{                            
 sh 'docker push gizachewgutu/microservice:$BUILD_NUMBER'           
 echo 'Push Image Completed'       
    }            
} 
 }
 }